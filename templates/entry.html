{% extends "page.html" %}

{% block ogmetadata %}
  <meta property="og:title" content="{{ title }}">
  <meta property="og:url" content="{{ serverurl }}{{ entry.outuri }}">
  <meta property="og:description" content="{{ entry.excerpt }}">
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Andrew Plotkin">
  <meta property="og:article:published_time" content="{{ entry.published }}">
  {% for tag in entry.tags -%}
    <meta property="og:article:tag" content="{{ tag }}">
  {% endfor %}
{% endblock %}

{% block content %}
  <div class="EntryHead">
    <h2>{{ title }}</h2>
    <h4 class="Date">{{ entry.longpublished }}
    {% if entry.longupdated %}&nbsp; (updated {{ entry.longupdated }}){% endif %}
    </h4>
  
    {% if entry.tags %}
    <h4 class="Tags">Tagged:
      {% set comma = joiner(", ") %}
      {% for tag in entry.tags -%}
        {{ comma() }}<a href="/tag/{{ tag|tagfilename|urlencode }}">{{ tag }}</a>
      {%- endfor %}
    </h4>
    {% endif %}

    {% if totalcomments %}
    <h4 class="Tags">{{ totalcomments }} comments</h4>
    {% endif %}
  </div>

  <div class="EntryBody">
    {% autoescape false %}
    {{ entry.body }}
    {% endautoescape %}
  </div>

  {% if comments %}
    {% for com in comments %}
      {% if loop.first or loop.previtem.sourcename != com.sourcename %}
      <hr class="CommentDecl">
      <h3 class="CommentDecl">Comments {% if com.sourcename %}{{ com.sourcename }}{% endif %}</h3>
      {% endif %}
      <div class="Comment" {% if com.depth %}style="margin-left: {{ 2*com.depth }}em;"{% endif %}>
        <hr>
        <div class="CommentHead">
          {% if com.authoruri %}
            <a class="CommentAuthor" href="{{ com.authoruri }}">{% if com.authorname %}{{ com.authorname }}{% else %}anonymous{% endif %}</a>
          {% else %}
            <span class="CommentAuthor">{% if com.authorname %}{{ com.authorname }}{% else %}anonymous{% endif %}</span>
          {% endif %}
          ({{ com.longpublished }}):
        </div>
        {% autoescape false %}
        {{ com.body }}
        {% endautoescape %}
      </div>
    {% endfor %}
  {% endif %}
{% endblock %}
